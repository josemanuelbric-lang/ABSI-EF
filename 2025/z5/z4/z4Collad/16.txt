import matplotlib.pyplot as plt
import numpy as np
import math

def calcular_potencial_serie(limite_n):
    # Generar Serie A' (3k-1)
    serie_a_prima = [n for n in range(1, limite_n + 1) if (n + 1) % 3 == 0]
    potenciales = []
    
    for n in serie_a_prima:
        temp = n
        l_count = 0
        r_count = 0
        while temp > 1:
            if temp % 2 == 0:
                r_count += 1
                temp //= 2
            else:
                l_count += 1
                temp = 3 * temp + 1
        # Ecuación del Potencial Analítico
        psi = l_count * math.log2(3) - r_count
        potenciales.append(psi)
        
    return serie_a_prima, potenciales

# --- Ejecución ---
n_vals, psi_vals = calcular_potencial_serie(10000)

# --- Visualización ---
plt.figure(figsize=(12, 6))
plt.scatter(n_vals, psi_vals, s=2, color='teal', alpha=0.6, label="Números de la Serie A'")
plt.axhline(y=0, color='red', linestyle='--', linewidth=2, label="Barrera de Escape (Ψ=0)")

plt.title("Potencial de Descenso Ψ: La Succión Analítica de la Serie A'")
plt.xlabel("Valor Inicial N (Escala Logarítmica)")
plt.ylabel("Potencial Final Ψ (Balance L/R)")
plt.xscale('log')
plt.grid(True, which="both", ls="-", alpha=0.1)
plt.fill_between(n_vals, 0, min(psi_vals), color='blue', alpha=0.1, label="Zona de Colapso Gravitatorio")
plt.legend()
plt.show()

print(f"Máximo Potencial detectado: {max(psi_vals):.4f}")
print(f"Mínimo Potencial detectado: {min(psi_vals):.4f}")
print(f"Porcentaje de números en zona de colapso: {(sum(1 for p in psi_vals if p < 0) / len(psi_vals)) * 100}%")